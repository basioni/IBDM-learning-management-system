/*! BuddyDrive - v2.1.0 - 2017-04-11 11:17:17 PM UTC - https://github.com/mrpritchett/buddydrive/ */
window.buddydrive=window.buddydrive||{},function(a,b){buddydrive.Views=buddydrive.Views||{},buddydrive.View=buddydrive.Backbone.View.extend({inject:function(a){this.render(),b(a).html(this.el),this.views.ready()},prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}},cleanViews:function(a){_.each(this.views._views[a],function(a){a.remove()})}}),buddydrive.Views.Feedback=buddydrive.View.extend({tagName:"div",className:"buddydrive-feedback",initialize:function(){this.value=this.options.value,this.type="info",_.isUndefined(this.options.type)||"info"===this.options.type||(this.type=this.options.type)},render:function(){return this.$el.html(b("<p></p>").html(this.value).addClass(this.type)),this}}),buddydrive.Views.Main=buddydrive.View.extend({tagName:"div",initialize:function(){this._views={},this.breadCrumbs=new Backbone.Collection,this.actions=new Backbone.Collection,this.warnings=new Backbone.Model,this.views.set([new buddydrive.View({tagName:"ul",className:"subsubsub"}),new buddydrive.Views.Toolbar({actions:this.actions}),new buddydrive.View({tagName:"div",id:"buddydrive-uploader",className:"buddydrive-hide"}),new buddydrive.View({tagName:"div",id:"buddydrive-actions-form",className:"buddydrive-hide"}),new buddydrive.View({tagName:"div",id:"buddydrive-status"}),new buddydrive.View({tagName:"ul",id:"buddydrive-browser"}),new buddydrive.View({tagName:"div",id:"buddydrive-pagination"})]),this.requestFiles(),this.collection.on("add",this.injectFile,this),this.collection.on("reset",this.cleanFiles,this),this.collection.on("remove",this.removeFileView,this),this.breadCrumbs.on("add",this.injectCrumb,this),this.breadCrumbs.on("reset",this.cleanCrumbs,this),this.actions.on("change:active",this.doToolbarActions,this),this.listenTo(buddydrive.App.Query,"change",this.requestFiles),_.isUndefined(buddydrive.Uploader)||(this.views.add("#buddydrive-uploader",new buddydrive.Views.UploadTool({actions:this.actions,warnings:this.warnings})),this.listenTo(buddydrive.Uploader.filesQueue,"add",this.insertFiles),this.listenTo(buddydrive.Uploader.filesError,"add",this.displayErrors),buddydrive.App.UploadParams=_.extend(_.pick(BP_Uploader.settings.defaults.multipart_params.bp_params,["item_id","privacy"]),{parent_folder_id:0})),this.listenTo(this.warnings,"change:message",this.displayErrors)},displayErrors:function(a){return a.get("message")?void this.views.add("#buddydrive-status",new buddydrive.Views.Feedback({type:"error",value:a.get("message")})):void this.cleanViews("#buddydrive-status")},insertFiles:function(a){this.collection.add(a)},removeFileView:function(a){_.each(this.views._views["#buddydrive-browser"],function(b){b.model.get("id")===a.get("id")&&b.remove()})},requestFiles:function(a){var b=!1;_.isUndefined(a)||(b=a.hasChanged("paged")&&1!==a.get("paged")),b||this.collection.reset(),this.views.set("#buddydrive-pagination",new buddydrive.Views.Loader),this.cleanViews("#buddydrive-status"),this.collection.fetch({data:buddydrive.App.Query.attributes,remove:!b,success:_.bind(this.filesFetched,this),error:_.bind(this.filesFetchError,this)})},filesFetched:function(a,b){this.breadCrumbs.reset();var c=[{id:"all",text:buddydrive.Strings.allCrumb,current:!0}],d=_.first(b.items)||{};(buddydrive.App.Query.get("buddydrive_parent")||buddydrive.App.Query.get("user_id"))&&(_.first(c).current=!1),buddydrive.App.Query.get("user_id")&&(_.isUndefined(d.user_avatar)||c.push({id:"user-"+buddydrive.App.Query.get("user_id"),text:d.user_avatar,current:!buddydrive.App.Query.get("buddydrive_parent")})),buddydrive.App.Query.get("buddydrive_parent")&&(_.isUndefined(d.post_parent_title)&&(d.post_parent_title=a.options.post_parent_title),c.push({id:"folder-"+buddydrive.App.Query.get("buddydrive_parent"),text:d.post_parent_title,current:!0})),this.breadCrumbs.add(c),a.options.has_more_items?this.views.set("#buddydrive-pagination",new buddydrive.Views.LoadMore({model:buddydrive.App.Query,text:buddydrive.Strings.loadMore})):this.cleanViews("#buddydrive-pagination"),_.isUndefined(a.options.no_items_found)||this.views.set("#buddydrive-status",new buddydrive.Views.Feedback({value:a.options.no_items_found}))},cleanFiles:function(){this.cleanViews("#buddydrive-browser")},cleanCrumbs:function(){this.cleanViews(".subsubsub")},filesFetchError:function(a,b){b.message&&(this.views.set("#buddydrive-status",new buddydrive.Views.Feedback({type:"error",value:b.message})),this.cleanViews("#buddydrive-pagination"))},injectFile:function(a){var b,c={};(a.get("uploading")||a.get("uploaded")||a.get("new_folder"))&&(c={at:0}),a.get("file_id")&&!_.isUndefined(buddydrive.Uploader)&&(b=_.indexOf(_.pluck(buddydrive.Uploader.filesQueue.models,"id"),a.get("file_id")),-1!==b&&(c={at:b})),this.collection.length>0&&a.get("new_folder")&&"title"===buddydrive.App.Query.get("orderby")&&(b=-1,_.each(this.collection.pluck("title").sort(function(a,b){return a.localeCompare(b)}),function(c,d){0>c.localeCompare(a.get("title"))&&(b=d+1)}),-1!==b&&(c={at:b})),this.views.add("#buddydrive-browser",new buddydrive.Views.File({model:a}),c)},injectCrumb:function(a){this.views.add(".subsubsub",new buddydrive.Views.BreadCrumb({model:a}))},doToolbarActions:function(a){return this.cleanViews("#buddydrive-status"),a.get("active")?(b(".buddydrive-share-dialog").addClass("buddydrive-hide"),void _.each(this.actions.models,function(c){a.get("id")===c.get("id")?"new_file"===a.get("id")?(b("#buddydrive-uploader").removeClass("buddydrive-hide"),b("#buddydrive-actions-form").addClass("buddydrive-hide"),b("#buddydrive-browser").removeClass("bulk-select"),buddydrive.App.Query.get("buddydrive_parent")&&!_.isUndefined(this.collection.options.post_parent_infos)&&this.views.set("#buddydrive-status",new buddydrive.Views.Feedback({value:this.collection.options.post_parent_infos})),b("#bp-upload-ui.drag-drop").find(".moxie-shim-html5").css({height:b("#bp-browse-button").outerHeight()+5+"px",width:b("#bp-browse-button").outerWidth()+5+"px",top:b("#bp-browse-button").position().top+"px",left:b("#bp-browse-button").position().left+"px"})):(b("#buddydrive-uploader").addClass("buddydrive-hide"),b("#buddydrive-actions-form").removeClass("buddydrive-hide"),b("#buddydrive-browser").removeClass("bulk-select"),"bulk"===a.get("id")?(b("#buddydrive-browser").addClass("bulk-select"),this.views.set("#buddydrive-actions-form",new buddydrive.Views.bulkEdit({collection:this.collection,bulkActions:buddydrive.Settings.bulk_actions,warnings:this.warnings}))):"new_folder"===a.get("id")?this.views.set("#buddydrive-actions-form",new buddydrive.Views.newFolder({model:c,warnings:this.warnings})):"stats"===a.get("id")&&this.views.set("#buddydrive-actions-form",new buddydrive.Views.userStats)):c.set("active",!1,{silent:!0})},this)):void("new_file"===a.get("id")?b("#buddydrive-uploader").addClass("buddydrive-hide"):(b("#buddydrive-actions-form").addClass("buddydrive-hide"),"bulk"===a.get("id")&&b("#buddydrive-browser").removeClass("bulk-select")))}}),buddydrive.Views.Loader=buddydrive.View.extend({tagName:"span",id:"buddydrive-loading"}),buddydrive.Views.File=buddydrive.View.extend({tagName:"li",template:buddydrive.template("buddydrive-file"),className:"buddydrive-item",events:{click:"bulkSelect","click .buddydrive-owner":"filterForUser","click .buddydrive-share":"showSharingBox","click .buddydrive-share-dialog-close":"hideSharingBox","click .buddydrive-share-url":"selectEmbed"},initialize:function(){this.listenTo(this.model,"change:percent",this.showProgress),this.listenTo(this.model,"change:id",this.deleteEntry),this.listenTo(this.model,"change:url",this.updateEntry),this.model.get("can_bulk_edit")||(this.el.className+=" not-bulk-editable")},deleteEntry:function(a){_.isUndefined(a.get("id"))&&(this.views.view.remove(),buddydrive.App.items.remove(a,{silent:!0}))},showProgress:function(a){_.isUndefined(a.get("percent"))||b("#"+a.get("id")+" .buddydrive-progress .buddydrive-bar").css("width",a.get("percent")+"%")},updateEntry:function(a){var b=_.extend({id:a.get("buddydrive_id"),file_id:a.get("id")},_.omit(a.attributes,["id","date","filename","uploading","buddydrive_id","url"]));buddydrive.App.items.remove(a),buddydrive.App.items.add(b)},bulkSelect:function(a){return b("#buddydrive-browser").hasClass("bulk-select")?(a.preventDefault(),void(this.model.get("bulk_selected")?(this.model.set("bulk_selected",!1),this.$el.removeClass("bulk-selected")):(this.model.set("bulk_selected",!0),this.$el.addClass("bulk-selected")))):a},filterForUser:function(a){return!b("body").hasClass("wp-admin")||b("#buddydrive-browser").hasClass("bulk-select")?a:(a.preventDefault(),buddydrive.App.Query.set({buddydrive_parent:0,paged:1},{silent:!0}),void buddydrive.App.router.navigate("user/"+b(a.currentTarget).data("user-id"),{trigger:!0}))},showSharingBox:function(a){return b("#buddydrive-browser").hasClass("bulk-select")?a:(a.preventDefault(),void this.$el.find(".buddydrive-share-dialog").removeClass("buddydrive-hide"))},hideSharingBox:function(a){a.preventDefault(),this.$el.find(".buddydrive-share-dialog").addClass("buddydrive-hide")},selectEmbed:function(a){a.preventDefault(),a.target.select()}}),buddydrive.Views.BreadCrumb=buddydrive.View.extend({tagName:"li",template:buddydrive.template("buddydrive-nav-item"),events:{"click .buddydrive-crumb":"allQuery"},initialize:function(){!0===this.model.get("current")&&(this.el.className="current")},allQuery:function(a){a.preventDefault();var c=b(a.currentTarget).data("crumb");"all"!==c&&c?(buddydrive.App.Query.set({buddydrive_parent:0,paged:1},{silent:!0}),buddydrive.App.router.navigate("#user/"+c.replace("user-",""),{trigger:!0})):buddydrive.App.router.navigate("#",{trigger:!0})}}),buddydrive.Views.manageBarItem=buddydrive.View.extend({tagName:"li",template:buddydrive.template("buddydrive-manage-toolbar"),events:{click:"doAction"},doAction:function(a){a.preventDefault(),this.model.get("active")?this.model.set("active",!1):this.model.set("active",!0)}}),buddydrive.Views.manageBar=buddydrive.View.extend({tagName:"ul",id:"buddydrive-manage-actions",initialize:function(){var a=buddydrive.App.Query.get("buddydrive_parent"),b="members"===buddydrive.Settings.buddydrive_scope;_.each(buddydrive.Settings.manage_toolbar,function(c){(!a&&!b||a&&"new_folder"!==c.id||"stats"===c.id)&&(this.collection.add(c),this.addItemBar(this.collection.get(c.id)))},this)},addItemBar:function(a){this.views.add(new buddydrive.Views.manageBarItem({model:a}))}}),buddydrive.Views.Toolbar=buddydrive.View.extend({tagName:"nav",className:"buddydrive-toolbar",initialize:function(){var a=[];this._views={},_.isUndefined(buddydrive.Uploader)||a.push(new buddydrive.Views.manageBar({collection:this.options.actions})),this.primary=new buddydrive.Views.LoopFilter({filters:buddydrive.Settings.loop_filters,current:buddydrive.App.Query.get("orderby")||"modified"}),this.secondary=new buddydrive.Views.SearchForm({model:buddydrive.App.Query}),this.views.set(_.union(a,[this.primary,this.secondary])),this.primary.model.on("change",this.orderQuery,this)},orderQuery:function(a){buddydrive.App.Query.set({orderby:a.get("selected"),paged:1})}}),buddydrive.Views.Input=buddydrive.View.extend({tagName:"input",initialize:function(){_.isObject(this.options)&&_.each(this.options,function(a,b){"value"===b?this.$el.val(a):this.$el.prop(b,a)},this)}}),buddydrive.Views.Label=buddydrive.Views.Input.extend({tagName:"label",render:function(){return this.$el.html(this.options.text),this}}),buddydrive.Views.Button=buddydrive.Views.Label.extend({tagName:"button"}),buddydrive.Views.LoadMore=buddydrive.Views.Button.extend({id:"buddydrive-load-more",events:{click:"loadMore"},loadMore:function(a){a.preventDefault(),this.model.set("paged",buddydrive.App.items.options.paged+1)}}),buddydrive.Views.SearchForm=buddydrive.Views.Input.extend({tagName:"input",className:"search",id:"buddydrive-search-input",attributes:{type:"search",placeholder:"Search"},events:{keyup:"maybeSearch",search:"search"},render:function(){return this.el.value=this.model.escape("search"),this},search:function(a){a.target.value?this.model.set("search",a.target.value):this.model.unset("search")},maybeSearch:function(a){return!0===/WebKit/.test(navigator.userAgent)?void a.preventDefault():void(13===a.keyCode&&this.search(a))}}),buddydrive.Views.PrivacyFilter=buddydrive.View.extend({tagName:"select",id:"buddydrive-privacy-filter",attributes:{name:"privacy","aria-label":buddydrive.Strings.privacyFilterLabel},events:{change:"change"},keys:[],initialize:function(){var a=this.options.current;this.model=new Backbone.Model,this.filters=this.options.filters||{},this.$el.html(_.chain(this.filters).map(function(c,d){return{el:a===d?b("<option></option>").val(d).html(c.text).prop("selected",!0)[0]:b("<option></option>").val(d).html(c.text)[0],priority:c.priority||5}},this).sortBy("priority").pluck("el").value())},change:function(){var a=this.filters[this.el.value];a&&this.model.set({selected:this.el.value})}}),buddydrive.Views.bulkEdit=buddydrive.View.extend({tagName:"div",id:"buddydrive-bulk-edit",events:{"click .bulk-action":"doBulkEdit"},initialize:function(){this.bulkActions=this.options.bulkActions||{},this.options.warnings.get("message")&&this.options.warnings.clear(),this.$el.html(_.chain(this.bulkActions).map(function(a){var c="button-primary button-large bulk-action";return"remove"!==a.id||buddydrive.App.Query.get("buddydrive_parent")||(c+=" buddydrive-hide"),b("<button></button>").html(a.text).prop("class",c).attr("data-action",a.id)[0]},this).value())},doBulkEdit:function(a){var c=[];a.preventDefault(),_.each(this.collection.models,function(a){!0===a.get("bulk_selected")&&c.push(a.get("id"))}),c.length&&this.collection.bulkEdit({data:{type:b(a.currentTarget).data("action"),items:c},error:_.bind(this.bulkError,this)})},bulkError:function(a){a.message&&this.options.warnings.set("message",a.message)}}),buddydrive.Views.userStats=buddydrive.View.extend({tagName:"div",id:"buddydrive-user-stats",template:buddydrive.template("buddydrive-stats"),initialize:function(){this.model=new buddydrive.Models.Stat,this.model.stat(),this.listenTo(this.model,"change:used",this.rerender)},rerender:function(){this.render()}}),buddydrive.Views.LoopFilter=buddydrive.Views.PrivacyFilter.extend({id:"buddydrive-filter",attributes:{name:"buddydrive_filter","aria-label":buddydrive.Strings.loopFilterLabel}}),buddydrive.Views.Item=buddydrive.View.extend({tagName:"li",className:"buddydrive-item",template:buddydrive.template("buddydrive-object"),attributes:{role:"checkbox"},initialize:function(){this.model.get("selected")&&(this.el.className+=" selected")},events:{click:"setObject","click .buddydrive-object-remove":"removeView"},setObject:function(a){a.preventDefault(),b(a.target).hasClass("buddydrive-object-remove")||(!0===this.model.get("selected")?this.model.set("selected",!1):this.model.set("selected",!0))},removeView:function(a){a.preventDefault(),this.model.set("selected",!1),this.views.view.remove()}}),buddydrive.Views.ObjectSelection=buddydrive.View.extend({tagName:"ul",id:"buddydrive-object-selection",initialize:function(){this.collection.on("add",this.addItemView,this),this.collection.on("reset",this.cleanView,this),this.listenTo(this.collection,"change:selected",this.updateSelection)},addItemView:function(a){var c=this.views.parent.model.get("type")||"";this.views.add(new buddydrive.Views.Item({model:a})),"group"===a.get("buddydrive_type")&&a.get("selected")&&"folder"===c&&!b("#buddydrive-lookfor").hasClass("buddydrive-hide")&&b("#buddydrive-lookfor").addClass("buddydrive-hide")},cleanView:function(){_.each(this.views._views[""],function(a){a.remove()})},updateSelection:function(a){var c=this.views.parent.model.get("type")||"";!1===a.get("selected")&&this.collection.remove(a),"group"===a.get("buddydrive_type")&&"folder"===c&&b("#buddydrive-lookfor").hasClass("buddydrive-hide")&&b("#buddydrive-lookfor").removeClass("buddydrive-hide")}}),buddydrive.Views.AutoComplete=buddydrive.Views.ObjectSelection.extend({tagName:"ul",id:"buddydrive-autocomplete",events:{keyup:"autoComplete"},initialize:function(){var a=new buddydrive.Views.Input({type:"text",id:"buddydrive-lookfor",placeholder:this.options.placeholder||""}).render();this.$el.prepend(b("<li></li>").html(a.$el)),this.collection.on("add",this.maybeAddItemView,this),this.collection.on("reset",this.cleanView,this),this.listenTo(this.collection,"change:selected",this.updateSelection)},maybeAddItemView:function(a){this.options.selection.get(a.get("id"))||this.addItemView(a)},autoComplete:function(){var a=b("#buddydrive-lookfor").val();this.collection.reset(),2>a.length||this.collection.fetch({data:_.extend(_.pick(buddydrive.Settings,"buddydrive_scope"),{buddydrive_type:this.options.buddydrive_type,user_id:this.options.user_id,search:a}),success:_.bind(this.itemFetched,this),error:_.bind(this.itemFetched,this)})},itemFetched:function(a){a.length||this.cleanView()},updateSelection:function(a){var c=this.options.allow_multiple||!1;!0===this.options.is_folder&&"groups"===this.options.buddydrive_type&&(c=!1),!0===a.get("selected")?(this.options.selection.add(a),b("#buddydrive-lookfor").val(""),this.cleanView(),c||this.$el.addClass("buddydrive-hide")):c||this.$el.removeClass("buddydrive-hide")}}),buddydrive.Views.EditForm=buddydrive.View.extend({tagName:"section",className:"buddydrive-item",initialize:function(){this.warnings=new Backbone.Model,this.listenTo(this.warnings,"change:message",this.displayErrors),this.views.add(new buddydrive.View({tagName:"header",id:"buddydrive-item-header"})),this.views.add(new buddydrive.View({tagName:"article",id:"buddydrive-item-content"})),this.views.add(new buddydrive.View({tagName:"div",id:"buddydrive-status"})),_.isUndefined(this.model)?this.options.item_id&&(this.collection.fetch({data:_.extend(_.pick(buddydrive.Settings,"buddydrive_scope"),{id:this.options.item_id,is_edit:!0}),success:_.bind(this.itemFetched,this),error:_.bind(this.itemError,this)}),this.collection.on("add",this.displayDetails,this)):this.displayDetails(this.model)},itemFetched:function(a,c){a.length?(b("header#buddydrive-item-header").removeClass("buddydrive-hide"),b("article#buddydrive-item-content").removeClass("buddydrive-hide")):(b("header#buddydrive-item-header").addClass("buddydrive-hide"),b("article#buddydrive-item-content").addClass("buddydrive-hide"),_.isUndefined(c.metas.no_items_found)||this.warnings.set("message",c.metas.no_items_found))},itemError:function(a,c){c.message&&(b("header#buddydrive-item-header").addClass("buddydrive-hide"),b("article#buddydrive-item-content").addClass("buddydrive-hide"),this.warnings.set("message",c.message))},displayErrors:function(a){this.cleanViews("#buddydrive-status"),this.views.add("#buddydrive-status",new buddydrive.Views.Feedback({type:a.get("type")||"error",value:a.get("message")}))},displayDetails:function(a){this.views.add("#buddydrive-item-header",new buddydrive.Views.editHeader({model:a})),this.views.add("#buddydrive-item-content",new buddydrive.Views.Edit({model:a,warnings:this.warnings}))}}),buddydrive.Views.editHeader=buddydrive.View.extend({tagName:"div",template:buddydrive.template("buddydrive-edit-header")}),buddydrive.Views.Edit=buddydrive.View.extend({tagName:"form",template:buddydrive.template("buddydrive-edit-details"),className:"buddydrive-item-details",events:{reset:"resetItem",submit:"updateItem","click #buddydrive-remove-parent":"removeParentFolder"},initialize:function(){this.resetModel=this.model.clone(),this.bpobjects=new buddydrive.Collections.bpObjects,this.privacyFilters=buddydrive.Settings.privacy_filters,"folder"===this.model.get("type")&&(this.privacyFilters=_.omit(this.privacyFilters,"folder")),this.model.get("post_parent")||this.privacyDetails()},privacyDetails:function(){var a=this.model.get("privacy"),b=new buddydrive.Views.PrivacyFilter({filters:this.privacyFilters,current:a});this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.Label({"for":"buddydrive-privacy-filter",text:buddydrive.Strings.privacyFilterLabel})),this.views.add("#buddydrive-privacy-edit",b),"password"===a?this.passwordFrame():("groups"===a||"folder"===a||"members"===a)&&this.objectFrame(a),b.model.on("change",this.updatePrivacyOptions,this)},passwordFrame:function(){this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.Label({"for":"buddydrive-edit-password",text:buddydrive.Strings.passwordInputLabel})),this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.Input({type:"text",id:"buddydrive-edit-password",name:"password",value:this.model.get("password")}))},objectFrame:function(a){var b=!1,c="",d={};this.bpobjects.reset(),this.selection=this.bpobjects.clone(),_.isUndefined(this.privacyFilters[a])||(b=this.privacyFilters[a].allow_multiple,c=this.privacyFilters[a].autocomplete_placeholder),this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.AutoComplete({collection:this.bpobjects,user_id:this.model.get("user_id"),buddydrive_type:a,allow_multiple:b,placeholder:c,selection:this.selection,is_folder:"folder"===this.model.get("type")})),this.views.add("#buddydrive-privacy-edit",new buddydrive.Views.ObjectSelection({collection:this.selection})),"groups"===a&&this.model.get("group")&&(d={user_id:this.model.get("user_id"),include:this.model.get("group"),buddydrive_type:"groups",existing:!0}),"members"===a&&this.model.get("members")&&(d={include:this.model.get("members"),buddydrive_type:"members",existing:!0}),!0===d.existing&&this.selection.fetch({data:_.extend(_.pick(buddydrive.Settings,"buddydrive_scope"),d)})},resetItem:function(a){a.preventDefault(),!0!==this.model.get("saving")&&Backbone.history.history.back()},updateItem:function(a){if(a.preventDefault(),!0!==this.model.get("saving")){var b=_.pick(this.model.attributes,["id","user_id","title","content","privacy"]),c={},d=[];if(_.each(this.$el.serializeArray(),function(a){a.name=a.name.replace("[]",""),-1!==_.indexOf(["title","content","privacy","buddydrive_object","password"],a.name)?"buddydrive_object"===a.name?_.isArray(b[b.privacy])?b[b.privacy].push(a.value):b[b.privacy]=[a.value]:b[a.name]=a.value:-1===_.indexOf(["id","user_id"],a.name)&&(_.isUndefined(c[a.name])?c[a.name]=a.value:(_.isArray(c[a.name])||(c[a.name]=[c[a.name]]),c[a.name].push(a.value)))}),b.title||d.push("title"),-1===_.indexOf(["folder","groups","members","password"],b.privacy)||!_.isUndefined(b[b.privacy])&&b[b.privacy].length||d.push(b.privacy),0!==d.length)return void this.options.warnings.set("message",buddydrive.Strings.editErrors[_.first(d)]);this.options.warnings.set({type:"info",message:buddydrive.Strings.saveEdits}),this.model.get("post_parent")&&"folder"!==b.privacy&&(b.parent_folder_id=0,this.model.set("post_parent",0,{silent:!0})),"folder"===b.privacy&&_.isArray(b.folder)&&this.model.set("post_parent",_.first(b.folder),{silent:!0}),this.model.set("saving",!0),this.model.update(_.extend(b,c),{success:_.bind(this.itemUpdated,this),error:_.bind(this.itemUpdateError,this)})}},itemUpdated:function(){var a="#";this.model.set("saving",!1),this.model.get("post_parent")&&(a="#view/"+this.model.get("post_parent")),buddydrive.App.Query.set({orderby:"modified",search:""},{silent:!0}),buddydrive.App.router.navigate(a,{trigger:!0})},itemUpdateError:function(a){this.model.set("saving",!1),a.message&&this.options.warnings.set({type:"error",message:a.message})},removeParentFolder:function(a){a.preventDefault(),b(a.currentTarget).closest("#buddydrive-item-folder").remove(),this.privacyDetails()},updatePrivacyOptions:function(a){var b=a.get("selected"),c=!1;_.each(this.views._views["#buddydrive-privacy-edit"],function(a,b){_.isUndefined(a.options.filters)||(c=b+1),_.isNumber(c)&&b>=c&&a.remove()}),"password"===b?this.passwordFrame():("groups"===b||"folder"===b||"members"===b)&&this.objectFrame(b)}}),"undefined"!=typeof BP_Uploader&&(buddydrive.Views.UploadTool=buddydrive.View.extend({className:"bp-uploader-window",template:buddydrive.template("upload-window"),defaults:_.pick(BP_Uploader.settings.defaults,["container","drop_element","browse_button"]),initialize:function(){this.model=new Backbone.Model(this.defaults),this.on("ready",this.initUploader)},initUploader:function(){this.uploader=new buddydrive.Uploader.uploader,b(this.uploader).on("bp-uploader-warning",_.bind(this.setWarning,this)),b(this.uploader).on("bp-uploader-new-upload",_.bind(this.resetWarning,this)),b(this.uploader).on("bp-uploader-upload-complete",_.bind(this.resetObject,this))},setWarning:function(a,b){_.isUndefined(b)||this.options.warnings.set("message",b)},resetWarning:function(a,b){_.isUndefined(buddydrive.App.Query.get("user_id"))||"admin"!==buddydrive.Settings.buddydrive_scope||(b.settings.multipart_params.bp_params.item_id=buddydrive.App.Query.get("user_id")),_.isUndefined(buddydrive.App.Query.get("buddydrive_parent"))||(b.settings.multipart_params.bp_params.parent_folder_id=buddydrive.App.Query.get("buddydrive_parent"),"admin"===buddydrive.Settings.buddydrive_scope&&_.isUndefined(buddydrive.App.Query.get("user_id"))&&!_.isUndefined(buddydrive.App.items.options.post_parent_owner)&&(b.settings.multipart_params.bp_params.item_id=buddydrive.App.items.options.post_parent_owner)),"friends"===buddydrive.Settings.buddydrive_scope&&(b.settings.multipart_params.bp_params.privacy=buddydrive.Settings.buddydrive_scope),this.options.warnings.clear()},resetObject:function(a,c){_.extend(c.settings.multipart_params.bp_params,buddydrive.App.UploadParams),b("#buddydrive-uploader").addClass("buddydrive-hide"),this.options.actions.get("new_file").set("active",!1,{silent:!0})}}),buddydrive.Views.newFolder=buddydrive.View.extend({tagName:"div",id:"buddydrive-new-folder",events:{"click #create-folder":"createFolder"},initialize:function(){this._views={},this.options.warnings.get("message")&&this.options.warnings.clear(),this.views.set([new buddydrive.Views.Input({type:"text",id:"buddydrive-folder-title",name:"title",placeholder:buddydrive.Strings.new_folder_name}),new buddydrive.Views.Button({id:"create-folder","class":"button-primary button-large",text:buddydrive.Strings.new_folder_button})])},createFolder:function(a){a.preventDefault();var c=b("#buddydrive-folder-title").val(),d={};c&&(d={title:c,user_id:buddydrive.App.Query.get("user_id")},"friends"===buddydrive.Settings.buddydrive_scope&&(d.privacy=buddydrive.Settings.buddydrive_scope),buddydrive.App.items.addFolder({data:d,error:_.bind(this.folderError,this)}),this.model.set("active",!1))},folderError:function(a){a.message&&this.options.warnings.set("message",a.message)}}))}(buddydrive,jQuery);